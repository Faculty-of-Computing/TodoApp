<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Todo App - Welcome</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 115vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background-image: url("{{ url_for('static', filename='images/uu.png') }}");
      background-repeat: no-repeat;
      background-position: center center;
      background-size: cover;
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
    }

    main {
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      margin: 2rem auto;
      width: 100%;
      max-width: 680px;
      border-radius: 30px;
      border: 1px solid rgba(255,255,255,0.2);
      position: relative;
      background-color: white;
    }

    h1 {
      color: #2B49F3;
      font-size: 2rem;
      margin-bottom: 2rem;
    }

    /* Logout button */
    .logout-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background-color: #ff4d4f;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      transition: background 0.3s ease;
    }

    .logout-btn:hover {
      background-color: #d9363e;
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      main { padding: 1.5rem; border-radius: 20px; max-width: 85%; }
      .logout-btn { font-size: 0.8rem; padding: 0.5rem 1rem; }
    }
  </style>
</head>
<body>
  <main>
    <!-- Logout Button -->
    <button class="logout-btn" onclick="logoutUser()">
      <i class="fa-solid fa-right-from-bracket"></i> Logout
    </button>

    <header class="todo-header">
      <h1>Welcome, {{ session.username }}</h1>

      <!-- Search bar -->
      <form method="GET" action="/" class="search-bar">
        <i class="fas fa-search search-icon"></i>
        <input type="text" name="search" placeholder="Search tasks..." value="{{ request.args.get('search', '') }}"/>
      </form>

      <img src="{{ url_for('static', filename='images/do.png') }}" alt="To-Do Icon" class="login-icon" />
      <div class="filter-wrapper">
        <form method="GET" action="/">
          <select name="filter" onchange="this.form.submit()">
            <option value="">-- Filter Tasks --</option>
            <option value="pending" {% if request.args.get('filter') == 'pending' %}selected{% endif %}>Pending</option>
            <option value="completed" {% if request.args.get('filter') == 'completed' %}selected{% endif %}>Completed</option>
            <option value="high" {% if request.args.get('filter') == 'high' %}selected{% endif %}>High Priority</option>
            <option value="medium" {% if request.args.get('filter') == 'medium' %}selected{% endif %}>Medium Priority</option>
            <option value="low" {% if request.args.get('filter') == 'low' %}selected{% endif %}>Low Priority</option>
          </select>
        </form>
      </div>
    </header>

    <div class="add-task-wrapper">
      <a href="{{ url_for('add_page') }}" class="add-btn" aria-label="Add Task">
        <span class="plus"><i class="fa-solid fa-plus"></i></span>
        <span class="text">Add Task</span>
      </a>
    </div>

    <section>
      <h2>Pending Tasks</h2>
      <ul class="todo-list">
        {% if pending_tasks %}
          {% for task in pending_tasks %}
            <li class="todo-item">
              <form method="POST" action="{{ url_for('complete_task', task_id=task.id) }}">
                <input type="checkbox" id="task{{ task.id }}" onchange="this.form.submit()"/>
                <label for="task{{ task.id }}">{{ task.task }}</label>
              </form>
              <button class="info-btn" onclick="location.href='{{ url_for('add_page') }}?task_id={{ task.id }}'">
                <i class="fa-solid fa-circle-info"></i>
              </button>
            </li>
          {% endfor %}
        {% else %}
          <li>No pending tasks</li>
        {% endif %}
      </ul>
    </section>

    <section>
      <h2>Completed Tasks</h2>
      <ul class="todo-list">
        {% if completed_tasks %}
          {% for task in completed_tasks %}
            <li class="todo-item completed">
              <form method="POST" action="{{ url_for('reopen_task', task_id=task.id) }}">
                <input type="checkbox" id="task{{ task.id }}" checked onchange="this.form.submit()"/>
                <label for="task{{ task.id }}">
                  {{ task.task }}
                  <span class="timestamp">Completed at {{ task.completed_at }}</span>
                </label>
              </form>
              <button class="info-btn" onclick="location.href='{{ url_for('add_page') }}?task_id={{ task.id }}'">
                <i class="fa-solid fa-circle-info"></i>
              </button>
            </li>
          {% endfor %}
        {% else %}
          <li>No completed tasks</li>
        {% endif %}
      </ul>
    </section>
  </main>

  <script>
    function logoutUser() {
      // Go back to previous site if available, else fallback to homepage
      if (document.referrer) {
        window.location.href = document.referrer;
      } else {
        window.location.href = "/";
      }
    }
  </script>
</body>
  </html>
  
